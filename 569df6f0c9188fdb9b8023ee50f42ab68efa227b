{
  "comments": [
    {
      "key": {
        "uuid": "ce38dbff_9fde36dd",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 93
      },
      "writtenOn": "2016-04-07T13:23:01Z",
      "side": 1,
      "message": "Can you try replacing this line with:\n\n$id \u003d $this-\u003epage-\u003egetMessageGroupId()\nMessageGroupStats::clearGroup( $id );\nMessageGroupStats::forGroup( $id );\n\nThis should effectively immediately recalculate the statistics.",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_fafb100f",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 93
      },
      "writtenOn": "2016-04-07T13:50:23Z",
      "side": 1,
      "message": "I just checked myself and this indeed fixes the stats updating on all pages when page is re-marked for translation.\n\nThere is small risk that MessageIndexJob is not completed first, especially if there are multiple JobRunner threads.\n\nI would consider adding \"MessageIndex::singleton()-\u003erebuild();\" before the cache updating lines here and remove the job insertion from the special page.",
      "parentUuid": "ce38dbff_9fde36dd",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_18c87d76",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 892
      },
      "writtenOn": "2016-04-07T16:23:54Z",
      "side": 1,
      "message": "Yeah, this does fix it (thanks) but will probably make the job slow. So the render jobs would also be blocked by this thus making it appear for the user that the updates might not happen (again). I don\u0027t know how much time it takes to rebuild the index on large wikis and also there is the risk of the job getting killed due to max execution time.",
      "parentUuid": "ce38dbff_fafb100f",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_f88039fb",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 892
      },
      "writtenOn": "2016-04-07T16:32:59Z",
      "side": 1,
      "message": "OK, so I think what we need to do here is not to block the render jobs and add a new job for rebuilding the index + updating the stats + purging. Propagating the updates is more important than stats regeneration and delaying that is probably okay. What do you think?",
      "parentUuid": "ce38dbff_18c87d76",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_b87231e0",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 93
      },
      "writtenOn": "2016-04-07T17:39:09Z",
      "side": 1,
      "message": "Render jobs are important, but I think the gains for skipping the stats update is not very big. If we did render jobs first, we would need to purge the pages very soon after again for updated stats.",
      "parentUuid": "ce38dbff_f88039fb",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_b8499192",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 892
      },
      "writtenOn": "2016-04-07T17:45:12Z",
      "side": 1,
      "message": "My concern is that rebuilding the index could probably take a lot of time but I don\u0027t know how much time it takes actually (just guessing). If isn\u0027t actually very slow, I\u0027m fine with it.",
      "parentUuid": "ce38dbff_b87231e0",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_383461f1",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 93
      },
      "writtenOn": "2016-04-07T17:49:50Z",
      "side": 1,
      "message": "Message index rebuild takes couple of seconds on mediawiki.org (the one with most translatable pages). Same for translatewiki.net.",
      "parentUuid": "ce38dbff_b87231e0",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_1806bd23",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 892
      },
      "writtenOn": "2016-04-07T17:56:14Z",
      "side": 1,
      "message": "Hmm, that\u0027s acceptable then. I suppose we can now remove the $sourceLangTitle job in getRenderJobs().",
      "parentUuid": "ce38dbff_383461f1",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ce38dbff_1b151741",
        "filename": "utils/TranslationsUpdateJob.php",
        "patchSetId": 7
      },
      "lineNbr": 35,
      "author": {
        "id": 892
      },
      "writtenOn": "2016-04-07T17:59:29Z",
      "side": 1,
      "message": "It\u0027s after translation units update so better to leave it as it is.",
      "parentUuid": "ce38dbff_1806bd23",
      "revId": "569df6f0c9188fdb9b8023ee50f42ab68efa227b",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}